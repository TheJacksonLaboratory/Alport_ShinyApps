#load essential data -------------------
load("/projects/ytakemon/Col4a5xDO/best.compiled.genoprob/genoprobs/best.genoprobs.192.Rdata")
load("/projects/ytakemon/Col4a5xDO/best.compiled.genoprob/Gene_allele.Rdata")
Gene_allele <- as.data.frame(Gene_allele)
load("/projects/ytakemon/Col4a5xDO/best.compiled.genoprob/RNA_seq_Rdata/All_transcript_TPM.Rdata")

gene <- "Aspa"
# Get mm10 data
ensembl <- useEnsembl(biomart = "ENSEMBL_MART_ENSEMBL",
											dataset = "mmusculus_gene_ensembl",
											verbose = TRUE)
mart_extract <- getBM(attributes = c("ensembl_gene_id", "mgi_symbol", "ensembl_transcript_id",
																"chromosome_name", "start_position", "end_position"),
                                filters = "mgi_symbol",
                                values = gene,
																mart = ensembl)
# Extract transcript list for input gene
transcript_list <- mart_extract$ensembl_transcript_id
gene_id <- mart_extract$ensembl_gene_id[1]

#Create new dataframe with only TPM from list of transcirpts
TPM <- All_transcript_tpm[,transcript_list]

#plot dot plot with discrete x and continuous y
#change dataframe format
#plot non-transformed TPM
gg_data <- melt(TPM, id.vars = transcript_list,
	value.name = "TPM")
names(gg_data)[2] <- "Transcripts"


ggplot <- ggplot(gg_data, aes(x =Transcripts, y = TPM, fill =Transcripts)) +
	geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 0.02) +
	scale_x_discrete(paste0(gene, " Transcripts")) +
	scale_y_continuous("TPM Counts") +
  guides(fill = FALSE)+
	labs( title = paste0("Comparison of ", gene, " transcript TPM counts")) +
	theme( plot.title = element_text(hjust = 0.5), axis.text.x=element_text(angle = 15, vjust = 0.5))

#Plot non-transformd TPM by allele
gg_data <- TPM
gg_data <- as.data.frame(gg_data)
gg_data$allele <- Gene_allele[, gene_id]
gg_data <- melt(gg_data)
colnames(gg_data) <- c("Allele", "Transcripts", "Value")

ggplot(gg_data, aes( x = Transcripts, y = Value, fill = Allele)) +
	geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 0.02, position = position_dodge(0.5)) +
	scale_x_discrete(paste0(gene, " Transcripts")) +
	scale_y_continuous("TPM Counts") +
	labs( title = paste0("Comparison of ", gene, " transcript TPM counts by allele")) +
	theme( plot.title = element_text(hjust = 0.5), axis.text.x=element_text(angle = 15, vjust = 0.5))
